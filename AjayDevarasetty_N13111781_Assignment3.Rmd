This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

# Question 1a
#Load in and clean up the data. The data will be messy. Once you get it loaded in, conduct exploratory data analysis in order to find out where there are outliers or missing values, decide how you will treat them, make sure the dates are formatted correctly, making sure values you think are numerical are being treated as such, etc.

#Solution:
#I had used manhattan_data from the http://www1.nyc.gov/site/finance/taxes/property-rolling-sales-data.page as given
#Also, I had loaded and cleaned the messy data and defined each class using the colClasses function

```{r}
manhattan_data <- read.csv(file.choose(), header=TRUE, skip = 4, colClasses = c("NEIGHBORHOOD" = "character", "ADDRESS" = "character","APARTMENT.NUMBER" = "character","LAND.SQUARE.FEET" = "character","GROSS.SQUARE.FEET" = "character","TAX.CLASS.AT.TIME.OF.SALE" = "factor","SALE.PRICE" = "character"))
str(manhattan_data)
```

#I had changed the formats for the sales date to month-date-year
#Changed the sales price to numbered format without commas using gsub and as.numeric functions for SALE.DATE column
#Changed the Land Sqaure feet to numbered format without commas using gsub and as.numeric functions for LAND.SQUARE.FEET and GROSS.SQUARE.FEET columns
#changing neighbourhood to a factor type variable using as.factor function

```{r}
manhattan_data$SALE.DATE <- as.Date(manhattan_data$SALE.DATE, format = "%m/%d/%Y")
manhattan_data$SALE.PRICE <-gsub(",","",manhattan_data$SALE.PRICE)
manhattan_data$SALE.PRICE <- as.numeric(manhattan_data$SALE.PRICE)

manhattan_data$LAND.SQUARE.FEET <-gsub(",","",manhattan_data$LAND.SQUARE.FEET)
manhattan_data$LAND.SQUARE.FEET <- as.numeric(manhattan_data$LAND.SQUARE.FEET)

manhattan_data$GROSS.SQUARE.FEET <-gsub(",","",manhattan_data$GROSS.SQUARE.FEET)
manhattan_data$GROSS.SQUARE.FEET <- as.numeric(manhattan_data$GROSS.SQUARE.FEET)

manhattan_data <- manhattan_data[-which(manhattan_data$NEIGHBORHOOD == "MANHATTAN-UNKNOWN        "),]
manhattan_data$NEIGHBORHOOD <- as.factor(manhattan_data$NEIGHBORHOOD)
```

#Removed the Borough aswellas the EASE.MENT column as they are not required: Column 1 and Column 6 respectively
#I had removed all the NULL values present in all the manhattan_data and replaced with NA values
#Also, We replaced TOTAL.UNITS column with 0 values as NA

```{r}
manhattan_data <- manhattan_data[,-1]
summary(manhattan_data$EASE.MENT)
manhattan_data <- manhattan_data[,-6]
str(manhattan_data)
manhattan_data$APARTMENT.NUMBER <- data.frame(gsub("            ",NA,manhattan_data$APARTMENT.NUMBER, fixed = TRUE))
colnames(manhattan_data[,8]) <- "APARTMENT.NUMBER"
manhattan_data$APARTMENT.NUMBER <- as.character(manhattan_data$APARTMENT.NUMBER)
manhattan_data$LAND.SQUARE.FEET[manhattan_data$LAND.SQUARE.FEET == 0] <-NA
manhattan_data$GROSS.SQUARE.FEET[manhattan_data$GROSS.SQUARE.FEET == 0] <-NA
manhattan_data$YEAR.BUILT[manhattan_data$YEAR.BUILT == 0] <- NA
manhattan_data$RESIDENTIAL.UNITS[manhattan_data$TOTAL.UNITS == 0] <- NA
manhattan_data$COMMERCIAL.UNITS[manhattan_data$TOTAL.UNITS == 0] <- NA
manhattan_data$TOTAL.UNITS[manhattan_data$TOTAL.UNITS == 0] <- NA

```

#Question 1b
#Once the data is in good shape. Conduct exploratory data analysis to make comparisons (i) across neighborhoods, and (ii) across time. You can use descriptive statistics and/or visualizations

#Solution:
#I deduced all the unique values of neighborhood and defined it as variable rolling_data. 
#Also, i foundd 38 unique values for each 38 neighborhoods. 
#For exploratory data analysis I used the summary for the sale price corresponding to the neighborhood.
#Used plot function to plot the sale price vs sale date and the sale price corresponding to the various neighborhoods.

```{r}
rolling_data <- unique(manhattan_data$NEIGHBORHOOD)
summary<- summary(manhattan_data$SALE.PRICE[manhattan_data$NEIGHBORHOOD == rolling_data[1]])
summary
for(i in 1:38){
plot(manhattan_data$SALE.PRICE[manhattan_data$NEIGHBORHOOD==rolling_data[i]],col=i, pch=20)}
plot(manhattan_data$SALE.DATE,manhattan_data$SALE.PRICE,col="steelblue", pch=20)
View(manhattan_data)
```

#Question 2a
#Analyze the sales data using regression with predictors you feel are relevant. Justify why regression was appropriate to use and which predictors you include in the model

#Solution:
#I had implemented regression and analyzed the sales data with relavent predictors such as Gross Square Feet, Land Square feet neighborhood and building class category factors in the manhattan data. 
#I used linear regression model as the sales price , gross and land square feet, neighborhood and building class category are correlated with each other

``` {r}
model <- lm(SALE.PRICE ~ GROSS.SQUARE.FEET+LAND.SQUARE.FEET+ factor(NEIGHBORHOOD)*factor(BUILDING.CLASS.CATEGORY), data = manhattan_data)
```
#Question 2b
#Visualize the coefficients and fitted regression model.

#Solution:
#I had visualized the model using the plot function and it gave me the coefficients of a fitted regression model

``` {r}
plot(resid(model), col='blue', pch=20)
```


#Question 2c
#Predict the neighborhood using a k-nearest neighbors classifier. Use a 10-fold cross validation, and report the error.

#Solution:
#We used two libraries caret and dplyr, to execute the k-nearest neighbors classifier and for trainControl functions
#Then 10 fold cross validation is applied using the control variable. Also i am training the neighborhood values and fitting them using sales data
#These fitted values are plotted and the error can be visualized and reported using the accuracy value from the plot function

``` {r}
library(caret)
library(dplyr)
Sales1 <- manhattan_data[which(manhattan_data$GROSS.SQUARE.FEET > 0 & manhattan_data$LAND.SQUARE.FEET >0 & manhattan_data$SALE.PRICE > 0),]
Sales2 <- Sales1[,c(1,9,14,13,15,18)]
control <- trainControl(method="repeatedcv",repeats = 10)      
fit <- train(NEIGHBORHOOD~ ., data = Sales2,trControl = control, method = "knn")
plot(fit)
```

#Question 2d
#Report and visualize your prediction findings.

#Solution:
#Using the accuracy values which we found in the previous question as well as using tje print function we can visualize and reportd the findings

```{r}
plot(fit)
print(fit)
```

#Question 2e
#Describe any decisions that could be made or actions that could be taken from this analysis

#Solution:
#The actions that can be taken after doing the analysis is to improve the accuracy which is found using the print function from the previous questions
#The observations which made to lead the decision is the accuracy which is less than 45%

#Question 3a
#Perform a PCA on the data after scaling the variables to have standard deviation equal to one

#Solution:
#I had used prcomp to perform the PCA on the parameters of Land Square feet, Gross square feet and Sales Price
#Here we had used Sales 3 function to define the manhattan sales with these three above mentioned parameters
#We have used na.action as na.omit to omit the NA values and predicted the PCA of the manhattan sales data

```{r}
Sales3 <- scale(Sales2[,c(3,4,6)])
View(Sales3)
PCA_manhattan_data = prcomp(~SALE.PRICE+GROSS.SQUARE.FEET+LAND.SQUARE.FEET,data=Sales1,na.action = na.omit,scale=T,center=T)
str(PCA_manhattan_data)
summary(PCA_manhattan_data)
predict(PCA_manhattan_data)
```

#Question 3b
#Plot the first three principal component score vectors in order to visualize the data. One way to do this is to generate one plot with the first two vectors as the x and y axes, and a second plot with the first and the third. How do you choose how to color each point

#Solution:
#In this question, we have plotted the first and second PCA vectors and first and third PCA vectors in the same x and y plot
#I have used two different colors as red and blue for PCA1 and PCA2 to differentiate between them

```{r}
biplot(PCA_manhattan_data,cex=1.5)
PCA_vector1 <- as.matrix(Sales3[,c(1:3)]) %*% PCA_manhattan_data$rot[,c(1,2)]
PCA_vector2 <- as.matrix(Sales3[,c(1:3)]) %*% PCA_manhattan_data$rot[,c(1,3)]
plot(PCA_vector1, col='red', pch=20)
points(PCA_vector2, col='blue', pch=20)
```